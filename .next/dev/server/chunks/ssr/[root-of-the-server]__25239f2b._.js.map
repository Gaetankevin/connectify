{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/gaetan/Bureau/ReactJS%20Experiences/hello-prisma/app/actions/auth.ts"],"sourcesContent":["\"use server\";\n\nimport { SignupFormSchema, FormState } from \"./../lib/definitions\";\nimport { prisma } from \"../../lib/prisma\";\nimport bcrypt from \"bcrypt\";\nimport { type User } from \"../../generated/prisma/client\";\nimport { createSession, destroySession } from \"../../lib/session\";\n\n\nexport async function signup(prevState: FormState, formData: FormData): Promise<FormState> {\n  const validatedFields = SignupFormSchema.safeParse({\n    name: formData.get(\"name\"),\n    surname: formData.get(\"surname\"),\n    username: formData.get(\"username\"),\n    email: formData.get(\"email\"),\n    password: formData.get(\"password\"),\n    confirmPassword: formData.get(\"confirmPassword\"),\n  });\n\n  // If any form fields are invalid, return early\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n    };\n  }\n\n  // 2. Prepare data for insertion into database\n  const { name,surname,username,email,password } = validatedFields.data;\n  // e.g. Hash the user's password before storing it\n  const hashedPassword = await bcrypt.hash(password, 10);\n  //il faudrait retourner l'id du user creer apres son inscription grace a prisma\n  const data = await prisma.user.create({\n    data: {\n      name: name,\n      surname: surname,\n      username: username,\n      email: email,\n      passwordHash: hashedPassword,\n      roleId: 3,\n      createdAt: new Date(),\n    },\n  });\n\n  const user :User = data;\n\n    if (!user) {\n    return {\n      message: 'An error occurred while creating your account.',\n    }\n  }\n  // create a DB-backed session and set cookie\n  try {\n    await createSession(user.id)\n  } catch (e) {\n    // session creation failed — we still return success for account creation,\n    // but log or handle as needed. For now, return an error state.\n    return { message: 'User created but failed to create session.' }\n  }\n\n  return { message: \"User created successfully\" };\n\n\n}\n\nexport async function logout() {\n  await destroySession()\n}\n"],"names":[],"mappings":";;;;;;;IASsB,SAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///home/gaetan/Bureau/ReactJS%20Experiences/hello-prisma/app/lib/definitions.ts"],"sourcesContent":["import * as z from \"zod\";\nexport const SignupFormSchema = z\n  .object({\n    name: z\n      .string()\n      .min(2, { message: \"Name must be at least 2 characters long\" })\n      .max(50, { message: \"Name must be at most 50 characters long\" })\n      .trim(),\n    surname: z\n      .string()\n      .min(2, { message: \"Surname must be at least 2 characters long\" })\n      .max(50, { message: \"Surname must be at most 50 characters long\" })\n      .trim(),\n    username: z\n      .string()\n      .min(3, { message: \"Username must be at least 3 characters long\" })\n      .max(30, { message: \"Username must be at most 30 characters long\" })\n      .regex(/^[a-zA-Z0-9_]+$/, {\n        message: \"Username can only contain letters, numbers, and underscores.\",\n      })\n      .trim(),\n    email: z.email({ message: \"Invalid email address\" }),\n    password: z\n      .string()\n      .min(8, { message: \"Password must be at least 8 characters long\" })\n      .regex(/[a-zA-Z]/, { message: \"Contain at least one letter.\" })\n      .regex(/[0-9]/, { message: \"Contain at least one number.\" })\n      .regex(/[^a-zA-Z0-9]/, {\n        message: \"Contain at least one special character.\",\n      })\n      .trim(),\n    confirmPassword: z.string(),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    path: [\"confirmPassword\"],\n    message: \"Passwords do not match\",\n  });\n\nexport type FormState =\n  | {\n      errors?: {\n        name?: string[];\n        surname?: string[];\n        username?: string[];\n        email?: string[];\n        password?: string[];\n        confirmPassword?: string[];\n      };\n      message?: string;\n    }\n  | undefined;\n"],"names":[],"mappings":";;;;AAAA;;AACO,MAAM,mBAAmB,yJACvB,CAAC;IACN,MAAM,yJACG,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA0C,GAC5D,GAAG,CAAC,IAAI;QAAE,SAAS;IAA0C,GAC7D,IAAI;IACP,SAAS,yJACA,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA6C,GAC/D,GAAG,CAAC,IAAI;QAAE,SAAS;IAA6C,GAChE,IAAI;IACP,UAAU,yJACD,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA8C,GAChE,GAAG,CAAC,IAAI;QAAE,SAAS;IAA8C,GACjE,KAAK,CAAC,mBAAmB;QACxB,SAAS;IACX,GACC,IAAI;IACP,OAAO,wJAAO,CAAC;QAAE,SAAS;IAAwB;IAClD,UAAU,yJACD,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA8C,GAChE,KAAK,CAAC,YAAY;QAAE,SAAS;IAA+B,GAC5D,KAAK,CAAC,SAAS;QAAE,SAAS;IAA+B,GACzD,KAAK,CAAC,gBAAgB;QACrB,SAAS;IACX,GACC,IAAI;IACP,iBAAiB,yJAAQ;AAC3B,GACC,MAAM,CAAC,CAAC,OAAS,KAAK,QAAQ,KAAK,KAAK,eAAe,EAAE;IACxD,MAAM;QAAC;KAAkB;IACzB,SAAS;AACX"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///home/gaetan/Bureau/ReactJS%20Experiences/hello-prisma/app/ui/login-form.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useActionState } from \"react\";\nimport { signup } from \"../actions/auth\";\nimport { SignupFormSchema } from \"../lib/definitions\";\n\ntype StepKey =\n\n  | \"username_email\"\n  | \"password\"\n\nconst steps: {\n  key: StepKey;\n  label: string;\n  type?: string;\n  placeholder?: string;\n}[] = [\n\n  {\n    key: \"username_email\",\n    label: \"Nom d'utilisateur\",\n    placeholder: \"Choisissez un nom d'utilisateur\",\n  },\n  {\n    key: \"password\",\n    label: \"Mot de passe\",\n    type: \"password\",\n    placeholder: \"Choisissez un mot de passe\",\n  }\n\n];\n\nexport default function LoginForm() {\n  const [state, action, pending] = useActionState(signup, undefined);\n\n  const [stepIndex, setStepIndex] = useState(0);\n  const [values, setValues] = useState<Record<StepKey, string>>({\n    username_email: \"\",\n    password: \"\",\n  });\n  const [error, setError] = useState<string | null>(null);\n  const [suggestions, setSuggestions] = useState<string[] | null>(null);\n  const [suggestLoading, setSuggestLoading] = useState(false);\n\n  const current = steps[stepIndex];\n\n  const getFieldSchema = (key: StepKey) => {\n    // @ts-ignore - using internal .shape of zod object\n    return (SignupFormSchema as any).shape[key];\n  };\n\n  async function checkUsernameAvailable(username: string) {\n    try {\n      const res = await fetch('/api/username/check', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ username })\n      })\n      const data = await res.json()\n      return data?.available === true\n    } catch (e) {\n      return false\n    }\n  }\n\n  async function checkEmailAvailable(email: string) {\n    try {\n      const res = await fetch('/api/email/check', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email })\n      })\n      const data = await res.json()\n      return data?.available === true\n    } catch (e) {\n      return false\n    }\n  }\n\n  async function validateField(key: StepKey, value: string) {\n    setError(null)\n    try {\n\n\n      const schema = getFieldSchema(key)\n      if (!schema) return true\n      schema.parse(value)\n\n      if (key === 'username_email') {\n        // server-side uniqueness check\n        const ok = await checkUsernameAvailable(value)\n        if (!ok) {\n          setError(\"Ce nom d'utilisateur est déjà pris\")\n          return false\n        }\n      }\n\n      return true\n    } catch (e: any) {\n      if (e?.issues && Array.isArray(e.issues)) {\n        setError(e.issues.map((i: any) => i.message).join(' '))\n      } else {\n        setError(e.message || 'Valeur invalide')\n      }\n      return false\n    }\n  }\n\n  async function onNext() {\n    const val = values[current.key]\n    const ok = await validateField(current.key, val)\n    if (!ok) return\n    setStepIndex((s) => Math.min(s + 1, steps.length - 1))\n  }\n\n  function onBack() {\n    setError(null);\n    setStepIndex((s) => Math.max(0, s - 1));\n  }\n\n  function onChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const v = e.target.value\n    setValues((prev) => ({ ...prev, [current.key]: v }))\n    // clear suggestions when user types a custom username\n    if (current.key === 'username_email') {\n      setSuggestions(null)\n      setError(null)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-6\">\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-lg p-6\">\n        <h1 className=\"text-center text-2xl font-bold mb-4\">Créer un compte</h1>\n\n        <form action={action} method=\"post\" className=\"space-y-6\">\n          {/* progress */}\n          <div className=\"flex items-center gap-2 justify-center\">\n            {steps.map((s, i) => (\n              <div\n                key={s.key}\n                className={`h-2 w-8 rounded ${\n                  i <= stepIndex ? \"bg-indigo-600\" : \"bg-gray-200\"\n                }`}\n              ></div>\n            ))}\n          </div>\n\n          {/* visible field */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              {current.label}\n            </label>\n            <input\n              autoFocus\n              name={current.key}\n              value={values[current.key]}\n              onChange={onChange}\n              type={current.type ?? \"text\"}\n              placeholder={current.placeholder}\n              className=\"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            />\n            {error && <p className=\"text-red-600 text-sm mt-2\">{error}</p>}\n            {current.key === 'username_email' && (\n              <div className=\"mt-3\">\n                <div className=\"flex items-center gap-2\">\n                  \n                  <p className=\"text-xs text-gray-500\">ou entrez le vôtre</p>\n                </div>\n\n                {suggestions && suggestions.length > 0 && (\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {suggestions.map((s) => (\n                      <button\n                        key={s}\n                        type=\"button\"\n                        onClick={() => {\n                          setValues((p) => ({ ...p, username: s }))\n                          setSuggestions(null)\n                          setError(null)\n                        }}\n                        className=\"text-sm px-3 py-1 bg-indigo-50 border rounded-full hover:bg-indigo-100\"\n                      >\n                        {s}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* hidden fields so final submit contains everything */}\n          {Object.entries(values).map(([k, v]) => (\n            <input key={k} type=\"hidden\" name={k} value={v} />\n          ))}\n\n          <div className=\"flex justify-between\">\n            <button\n              type=\"button\"\n              onClick={onBack}\n              disabled={stepIndex === 0}\n              className=\"px-4 py-2 rounded-lg border disabled:opacity-50\"\n            >\n              Retour\n            </button>\n            {stepIndex < steps.length - 1 ? (\n              <button\n                type=\"button\"\n                onClick={onNext}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg\"\n              >\n                Suivant\n              </button>\n            ) : (\n              <button\n                type=\"submit\"\n                disabled={pending}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg\"\n              >\n                {pending ? \"Création...\" : \"Créer le compte\"}\n              </button>\n            )}\n          </div>\n\n          {state?.message && <p className=\"text-green-600\">{state.message}</p>}\n          {state?.errors && (\n            <div className=\"text-red-600 text-sm\">\n              {Object.entries(state.errors).map(([k, v]) => (\n                <p key={k}>\n                  {k}: {Array.isArray(v) ? v.join(\", \") : v}\n                </p>\n              ))}\n            </div>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}