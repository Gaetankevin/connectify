{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/gaetan/Bureau/ReactJS%20Experiences/hello-prisma/app/lib/definitions.ts"],"sourcesContent":["import * as z from \"zod\";\nexport const SignupFormSchema = z\n  .object({\n    name: z\n      .string()\n      .min(2, { message: \"Name must be at least 2 characters long\" })\n      .max(50, { message: \"Name must be at most 50 characters long\" })\n      .trim(),\n    surname: z\n      .string()\n      .min(2, { message: \"Surname must be at least 2 characters long\" })\n      .max(50, { message: \"Surname must be at most 50 characters long\" })\n      .trim(),\n    username: z\n      .string()\n      .min(3, { message: \"Username must be at least 3 characters long\" })\n      .max(30, { message: \"Username must be at most 30 characters long\" })\n      .regex(/^[a-zA-Z0-9_]+$/, {\n        message: \"Username can only contain letters, numbers, and underscores.\",\n      })\n      .trim(),\n    email: z.email({ message: \"Invalid email address\" }),\n    password: z\n      .string()\n      .min(8, { message: \"Password must be at least 8 characters long\" })\n      .regex(/[a-zA-Z]/, { message: \"Contain at least one letter.\" })\n      .regex(/[0-9]/, { message: \"Contain at least one number.\" })\n      .regex(/[^a-zA-Z0-9]/, {\n        message: \"Contain at least one special character.\",\n      })\n      .trim(),\n    confirmPassword: z.string(),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    path: [\"confirmPassword\"],\n    message: \"Passwords do not match\",\n  });\n\nexport type RegisterFormState =\n  | {\n      errors?: {\n        name?: string[];\n        surname?: string[];\n        username?: string[];\n        email?: string[];\n        password?: string[];\n        confirmPassword?: string[];\n      };\n      message?: string;\n    }\n  | undefined;\nconst LoginFormSchema = z.object({\n  username_email: z.string().min(1, { message: \"Username or email is required\" }).trim(),\n  password: z.string().min(1, { message: \"Password is required\" }).trim(),\n});\nexport type LoginFormState =|\n{\n    errors?: {\n        username_email?: string[];\n        password?: string[];\n    };\n    message?: string;\n}\n|undefined"],"names":[],"mappings":";;;;AAAA;;AACO,MAAM,mBAAmB,4JACvB,CAAC;IACN,MAAM,4JACG,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA0C,GAC5D,GAAG,CAAC,IAAI;QAAE,SAAS;IAA0C,GAC7D,IAAI;IACP,SAAS,4JACA,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA6C,GAC/D,GAAG,CAAC,IAAI;QAAE,SAAS;IAA6C,GAChE,IAAI;IACP,UAAU,4JACD,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA8C,GAChE,GAAG,CAAC,IAAI;QAAE,SAAS;IAA8C,GACjE,KAAK,CAAC,mBAAmB;QACxB,SAAS;IACX,GACC,IAAI;IACP,OAAO,2JAAO,CAAC;QAAE,SAAS;IAAwB;IAClD,UAAU,4JACD,GACN,GAAG,CAAC,GAAG;QAAE,SAAS;IAA8C,GAChE,KAAK,CAAC,YAAY;QAAE,SAAS;IAA+B,GAC5D,KAAK,CAAC,SAAS;QAAE,SAAS;IAA+B,GACzD,KAAK,CAAC,gBAAgB;QACrB,SAAS;IACX,GACC,IAAI;IACP,iBAAiB,4JAAQ;AAC3B,GACC,MAAM,MAAC,CAAC,OAAS,KAAK,QAAQ,KAAK,KAAK,eAAe,EAAE;IACxD,MAAM;QAAC;KAAkB;IACzB,SAAS;AACX;;AAeF,MAAM,kBAAkB,4JAAQ,CAAC;IAC/B,gBAAgB,4JAAQ,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAgC,GAAG,IAAI;IACpF,UAAU,4JAAQ,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAuB,GAAG,IAAI;AACvE"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///home/gaetan/Bureau/ReactJS%20Experiences/hello-prisma/app/ui/login-form.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useActionState } from \"react\";\nimport { login } from \"../actions/auth\";\nimport { SignupFormSchema } from \"../lib/definitions\";\n\ntype StepKey =\n\n  | \"username_email\"\n  | \"password\"\n\nconst steps: {\n  key: StepKey;\n  label: string;\n  type?: string;\n  placeholder?: string;\n}[] = [\n\n  {\n    key: \"username_email\",\n    label: \"Nom d'utilisateur\",\n    placeholder: \"Choisissez un nom d'utilisateur\",\n  },\n  {\n    key: \"password\",\n    label: \"Mot de passe\",\n    type: \"password\",\n    placeholder: \"Choisissez un mot de passe\",\n  }\n\n];\n\nexport default function LoginForm() {\n  const [state, action, pending] = useActionState(signup, undefined);\n\n  const [stepIndex, setStepIndex] = useState(0);\n  const [values, setValues] = useState<Record<StepKey, string>>({\n    username_email: \"\",\n    password: \"\",\n  });\n  const [error, setError] = useState<string | null>(null);\n  const [suggestions, setSuggestions] = useState<string[] | null>(null);\n  const [suggestLoading, setSuggestLoading] = useState(false);\n\n  const current = steps[stepIndex];\n\n  const getFieldSchema = (key: StepKey) => {\n    // @ts-ignore - using internal .shape of zod object\n    return (SignupFormSchema as any).shape[key];\n  };\n\n  async function checkUsernameAvailable(username: string) {\n    try {\n      const res = await fetch('/api/username/check', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ username })\n      })\n      const data = await res.json()\n      return data?.available === true\n    } catch (e) {\n      return false\n    }\n  }\n\n  async function checkEmailAvailable(email: string) {\n    try {\n      const res = await fetch('/api/email/check', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email })\n      })\n      const data = await res.json()\n      return data?.available === true\n    } catch (e) {\n      return false\n    }\n  }\n\n  async function validateField(key: StepKey, value: string) {\n    setError(null)\n    try {\n\n\n      const schema = getFieldSchema(key)\n      if (!schema) return true\n      schema.parse(value)\n\n      if (key === 'username_email') {\n        // server-side uniqueness check\n        const ok = await checkUsernameAvailable(value)\n        if (!ok) {\n          setError(\"Ce nom d'utilisateur est déjà pris\")\n          return false\n        }\n      }\n\n      return true\n    } catch (e: any) {\n      if (e?.issues && Array.isArray(e.issues)) {\n        setError(e.issues.map((i: any) => i.message).join(' '))\n      } else {\n        setError(e.message || 'Valeur invalide')\n      }\n      return false\n    }\n  }\n\n  async function onNext() {\n    const val = values[current.key]\n    const ok = await validateField(current.key, val)\n    if (!ok) return\n    setStepIndex((s) => Math.min(s + 1, steps.length - 1))\n  }\n\n  function onBack() {\n    setError(null);\n    setStepIndex((s) => Math.max(0, s - 1));\n  }\n\n  function onChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const v = e.target.value\n    setValues((prev) => ({ ...prev, [current.key]: v }))\n    // clear suggestions when user types a custom username\n    if (current.key === 'username_email') {\n      setSuggestions(null)\n      setError(null)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-6\">\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-lg p-6\">\n        <h1 className=\"text-center text-2xl font-bold mb-4\">Créer un compte</h1>\n\n        <form action={action} method=\"post\" className=\"space-y-6\">\n          {/* progress */}\n          <div className=\"flex items-center gap-2 justify-center\">\n            {steps.map((s, i) => (\n              <div\n                key={s.key}\n                className={`h-2 w-8 rounded ${\n                  i <= stepIndex ? \"bg-indigo-600\" : \"bg-gray-200\"\n                }`}\n              ></div>\n            ))}\n          </div>\n\n          {/* visible field */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              {current.label}\n            </label>\n            <input\n              autoFocus\n              name={current.key}\n              value={values[current.key]}\n              onChange={onChange}\n              type={current.type ?? \"text\"}\n              placeholder={current.placeholder}\n              className=\"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            />\n            {error && <p className=\"text-red-600 text-sm mt-2\">{error}</p>}\n            {current.key === 'username_email' && (\n              <div className=\"mt-3\">\n                <div className=\"flex items-center gap-2\">\n                  \n                  <p className=\"text-xs text-gray-500\">ou entrez le vôtre</p>\n                </div>\n\n                {suggestions && suggestions.length > 0 && (\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {suggestions.map((s) => (\n                      <button\n                        key={s}\n                        type=\"button\"\n                        onClick={() => {\n                          setValues((p) => ({ ...p, username: s }))\n                          setSuggestions(null)\n                          setError(null)\n                        }}\n                        className=\"text-sm px-3 py-1 bg-indigo-50 border rounded-full hover:bg-indigo-100\"\n                      >\n                        {s}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* hidden fields so final submit contains everything */}\n          {Object.entries(values).map(([k, v]) => (\n            <input key={k} type=\"hidden\" name={k} value={v} />\n          ))}\n\n          <div className=\"flex justify-between\">\n            <button\n              type=\"button\"\n              onClick={onBack}\n              disabled={stepIndex === 0}\n              className=\"px-4 py-2 rounded-lg border disabled:opacity-50\"\n            >\n              Retour\n            </button>\n            {stepIndex < steps.length - 1 ? (\n              <button\n                type=\"button\"\n                onClick={onNext}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg\"\n              >\n                Suivant\n              </button>\n            ) : (\n              <button\n                type=\"submit\"\n                disabled={pending}\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded-lg\"\n              >\n                {pending ? \"Création...\" : \"Créer le compte\"}\n              </button>\n            )}\n          </div>\n\n          {state?.message && <p className=\"text-green-600\">{state.message}</p>}\n          {state?.errors && (\n            <div className=\"text-red-600 text-sm\">\n              {Object.entries(state.errors).map(([k, v]) => (\n                <p key={k}>\n                  {k}: {Array.isArray(v) ? v.join(\", \") : v}\n                </p>\n              ))}\n            </div>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}