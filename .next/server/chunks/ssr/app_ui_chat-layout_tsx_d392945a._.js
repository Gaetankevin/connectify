module.exports=[75175,a=>{"use strict";var b=a.i(87924),c=a.i(72131);async function d(a){let b=await fetch(`/api/users/search?q=${encodeURIComponent(a)}`,{credentials:"include"});if(!b.ok)throw Error("Failed to search users");return(await b.json()).users}async function e(){let a=await fetch("/api/conversations",{credentials:"include"});if(!a.ok)throw Error("Failed to fetch conversations");return(await a.json()).conversations}async function f(a){let b=await fetch("/api/conversations",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({otherUserId:a})});if(!b.ok)throw Error("Failed to create conversation");return b.json()}async function g(a){let b=await fetch(`/api/conversations/${a}`,{credentials:"include"});if(!b.ok)throw Error("Failed to fetch messages");return b.json()}async function h(a,b){let c;if(b.file){let d=new FormData;b.content&&d.append("content",b.content),d.append("file",b.file,b.file.name||"upload"),c=await fetch(`/api/conversations/${a}`,{method:"POST",credentials:"include",body:d})}else c=await fetch(`/api/conversations/${a}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok)throw Error("Failed to send message");return c.json()}function i(){let[a,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),L=(0,c.useRef)(null);(0,c.useEffect)(()=>{let a=()=>{window.innerWidth>=768&&G(!1)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,c.useEffect)(()=>{M()},[]),(0,c.useEffect)(()=>{j&&N(j)},[j]),(0,c.useEffect)(()=>{L.current?.scrollIntoView({behavior:"smooth"})},[l]),(0,c.useEffect)(()=>{if(!H){J&&(URL.revokeObjectURL(J),K(null));return}let a=URL.createObjectURL(H);return K(a),()=>{URL.revokeObjectURL(a),K(null)}},[H]);let M=async()=>{try{A(!0);let a=await e();i(a),a.length>0&&!j&&k(a[0].id)}catch(a){E("Failed to load conversations"),console.error(a)}finally{A(!1)}},N=async a=>{try{let{discussion:b,messages:c}=await g(a);o(b),m(c)}catch(a){E("Failed to load messages"),console.error(a)}},O=async a=>{if(a.length<2)return void w([]);try{let b=await d(a);w(b)}catch(a){console.error("Search failed:",a)}},P=async a=>{try{C(!0);let b=await f(a);await M(),k(b.id),q(!1),u(""),w([])}catch(a){E("Failed to create conversation"),console.error(a)}finally{C(!1)}},Q=async a=>{if((a.preventDefault(),j&&!B)&&(x.trim()||H))try{C(!0);let a=await h(j,{content:x.trim()||void 0,file:H||void 0});m([...l,a]),y(""),I(null),await M()}catch(a){E("Failed to send message"),console.error(a)}finally{C(!1)}},R=a.filter(a=>a.otherUser.name.toLowerCase().includes(r.toLowerCase())||a.otherUser.username.toLowerCase().includes(r.toLowerCase())),S=a.find(a=>a.id===j),T=a=>{let b=new Date(a),c=new Date().getTime()-b.getTime(),d=Math.floor(c/6e4),e=Math.floor(c/36e5),f=Math.floor(c/864e5);return d<1?"now":d<60?`${d}m ago`:e<24?`${e}h ago`:f<7?`${f}d ago`:b.toLocaleDateString()};return(0,b.jsxs)("div",{className:"h-screen flex bg-gray-100 overflow-hidden",children:[(0,b.jsxs)("div",{className:"w-full md:w-64 bg-white border-r border-gray-200 overflow-y-auto flex flex-col",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Messages"}),(0,b.jsx)("button",{onClick:()=>q(!0),className:"bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition",title:"New conversation",children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),(0,b.jsx)("input",{type:"text",placeholder:"Search conversations...",value:r,onChange:a=>s(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-200",children:z?(0,b.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading..."}):R.length>0?R.map(a=>(0,b.jsxs)("button",{onClick:()=>{k(a.id)},className:`w-full text-left px-4 py-3 transition ${j===a.id?"bg-indigo-50 border-l-4 border-indigo-600":"hover:bg-gray-50"}`,children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900 text-sm",children:[a.otherUser.name," ",a.otherUser.surname]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["@",a.otherUser.username]}),(0,b.jsx)("p",{className:"text-xs text-gray-600 truncate mt-1",children:a.lastMessage?.content||"No messages yet"}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:a.lastMessage?T(a.lastMessage.createdAt):""})]},a.id)):(0,b.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No conversations found"})})]}),(0,b.jsx)("div",{className:`fixed inset-0 bg-black/50 z-30 md:hidden ${F?"block":"hidden"}`,onClick:()=>G(!1)}),(0,b.jsx)("div",{className:`transform transition-transform duration-300 ease-in-out bg-white z-40 flex flex-col h-full md:relative md:transform-none md:flex md:flex-1 ${F?"fixed inset-0 translate-x-0":"fixed inset-0 translate-x-full md:translate-x-0"}`,style:{},children:S&&n?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"border-b border-gray-200 bg-white px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-3 md:hidden",children:(0,b.jsx)("button",{onClick:()=>G(!1),className:"p-2 rounded-md hover:bg-gray-100","aria-label":"Back to conversations",children:(0,b.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[S.otherUser.name," ",S.otherUser.surname]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["@",S.otherUser.username]})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[0===l.length?(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-center text-gray-500 py-8",children:(0,b.jsx)("p",{children:"Start the conversation!"})}):l.map(a=>(0,b.jsx)("div",{className:`flex ${a.senderId===S.otherUser.id?"justify-start":"justify-end"}`,children:(0,b.jsxs)("div",{className:`max-w-xs rounded-lg px-4 py-2 ${a.senderId===S.otherUser.id?"bg-gray-200 text-gray-900":"bg-indigo-600 text-white"}`,children:[a.content&&(0,b.jsx)("p",{className:"text-sm break-words",children:a.content}),a.mediaUrl&&(0,b.jsx)("div",{className:"mt-2",children:a.mediaType?.startsWith("image")?(0,b.jsx)("img",{src:a.mediaUrl,alt:"Message attachment",className:"max-w-xs rounded"}):(0,b.jsx)("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline",children:"Download attachment"})}),(0,b.jsx)("p",{className:"text-xs mt-1 opacity-70",children:T(a.createdAt)})]})},a.id)),(0,b.jsx)("div",{ref:L})]}),(0,b.jsxs)("div",{className:"border-t border-gray-200 bg-white px-6 py-4",children:[D&&(0,b.jsx)("div",{className:"mb-3 p-2 bg-red-100 text-red-700 text-sm rounded",children:D}),H&&J&&(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"max-w-xs max-h-48 overflow-hidden rounded",children:H.type.startsWith("image/")?(0,b.jsx)("img",{src:J,alt:"Preview",className:"object-cover w-48 h-32"}):H.type.startsWith("video/")?(0,b.jsx)("video",{src:J,controls:!0,className:"w-48 h-32 object-cover"}):(0,b.jsx)("div",{className:"w-48 h-32 flex items-center justify-center bg-gray-50 border rounded text-sm text-gray-600",children:(0,b.jsxs)("div",{className:"px-2 text-center",children:[(0,b.jsx)("div",{className:"font-semibold truncate",children:H.name}),(0,b.jsxs)("div",{className:"text-xs opacity-70",children:[(H.size/1024).toFixed(1)," KB"]})]})})}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:H.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:H.type||"Unknown type"})]}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"button",onClick:()=>I(null),className:"text-sm text-gray-500 hover:text-gray-800",children:"Remove"})})]})})]})}),(0,b.jsxs)("form",{onSubmit:Q,className:"flex items-center gap-3",children:[(0,b.jsx)("input",{type:"text",placeholder:"Type a message...",value:x,onChange:a=>y(a.target.value),disabled:B,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100"}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"file",accept:"image/*,video/*,application/pdf,application/*",onChange:a=>{I(a.target.files?.[0]||null)},className:"hidden"}),(0,b.jsx)("button",{type:"button",onClick:a=>{let b=a.currentTarget.closest("label")?.querySelector("input[type=file]");b?.click()},className:"p-2 rounded bg-gray-100 hover:bg-gray-200",title:"Attach file",children:(0,b.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828L18 9.828a4 4 0 10-5.656-5.656L6.343 10.172"})})})]}),(0,b.jsx)("button",{type:"submit","aria-label":B?"Envoi en cours":"Envoyer",title:B?"Envoi en cours":"Envoyer",disabled:B||!x.trim()&&!H,className:"bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition disabled:bg-gray-400 flex items-center justify-center",children:B?(0,b.jsxs)("svg",{className:"w-5 h-5 animate-spin",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"rgba(255,255,255,0.25)",strokeWidth:"4"}),(0,b.jsx)("path",{d:"M22 12a10 10 0 00-10-10",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]}):(0,b.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[(0,b.jsx)("path",{d:"M22 2L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M22 2l-7 20  -4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"rgba(255,255,255,0.03)"})]})})]})]})]})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-center",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,b.jsx)("p",{className:"text-gray-500 text-lg",children:z?"Loading...":"Select a conversation to start"})]})})}),p&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md mx-4",children:[(0,b.jsxs)("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Start New Conversation"}),(0,b.jsx)("button",{onClick:()=>{q(!1),u(""),w([])},className:"text-gray-400 hover:text-gray-600",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,b.jsx)("input",{type:"text",placeholder:"Search by name or username...",value:t,onChange:a=>{u(a.target.value),O(a.target.value)},autoFocus:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})}),(0,b.jsx)("div",{className:"max-h-96 overflow-y-auto divide-y divide-gray-200",children:v.length>0?v.map(a=>(0,b.jsxs)("button",{onClick:()=>P(a.id),disabled:B,className:"w-full text-left px-6 py-4 hover:bg-gray-50 transition flex items-center justify-between disabled:opacity-50",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900 text-sm",children:[a.name," ",a.surname]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["@",a.username]})]}),(0,b.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]},a.id)):t.length>0?(0,b.jsx)("div",{className:"p-6 text-center text-gray-500 text-sm",children:"No users found"}):(0,b.jsx)("div",{className:"p-6 text-center text-gray-500 text-sm",children:"Start typing to search users..."})})]})})]})}a.s(["default",()=>i],75175)}];

//# sourceMappingURL=app_ui_chat-layout_tsx_d392945a._.js.map